## ğŸ”¹ Contexto General del Proyecto

**Nombre del proyecto:** BioSafe
**Tipo:** AplicaciÃ³n multiplataforma (Android, iOS y Web)
**Framework:** Flutter
**Lenguaje:** Dart
**Backend:** Firebase (Plan Blaze)
**Estructura de datos:** Cloud Firestore
**AutenticaciÃ³n:** Firebase Auth
**OCR y Escaneo:** Google ML Kit + Mobile Scanner
**Notificaciones:** Firebase Cloud Messaging
**Almacenamiento:** Firebase Storage
**Objetivo:** Desarrollar una app accesible y multiplataforma que ayude a adultos mayores y familiares a gestionar medicamentos, recetas y tratamientos mÃ©dicos especiales.

---

## ğŸ”¹ Arquitectura General

**Colecciones principales en Firestore:**

1. **`users`**

   * ID â†’ `uid` (FirebaseAuth)
   * Campos:

     * `name` : string
     * `email` : string
     * `age` : number
     * `linked_family` : array<uid> (opcional, familiares con acceso)
     * `created_at` : timestamp

2. **`medicines`**

   * ID â†’ autogenerado
   * Campos:

     * `user_id` : uid (referencia al usuario propietario)
     * `name` : string
     * `type` : enum (â€œtabletasâ€, â€œlÃ­quidoâ€, â€œotroâ€)
     * `total_quantity` : number (tabletas o ml)
     * `remaining_quantity` : number (puede ser nulo o igual a total)
     * `dosage` : string (ej. â€œ1 tableta cada 8hâ€)
     * `expiration_date` : date
     * `photo_url` : string (si se usa OCR o cÃ¡mara)
     * `barcode` : string (si se registra por escaneo)
     * `created_at` : timestamp

3. **`treatments`**

   * ID â†’ autogenerado
   * Campos:

     * `user_id` : uid
     * `type` : enum (â€œdiabetesâ€, â€œpresiÃ³nâ€, â€œotroâ€)
     * `measurement_value` : number
     * `measurement_unit` : string (â€œmg/dLâ€, â€œmmHgâ€)
     * `timestamp` : date

4. **`notifications`**

   * ID â†’ autogenerado
   * Campos:

     * `user_id` : uid
     * `medicine_id` : referencia
     * `time` : timestamp
     * `message` : string
     * `status` : enum (â€œpendingâ€, â€œdoneâ€)

---

## ğŸ”¹ Funcionalidades Esenciales

### ğŸ§¾ AutenticaciÃ³n (FirebaseAuth)

* Permitir **inicio de sesiÃ³n y registro** con correo y contraseÃ±a.
* Al iniciar sesiÃ³n:

  * Descargar datos del usuario (`users` y `medicines`).
  * Guardar localmente en SQLite o Hive para modo offline.

---

### ğŸ’Š GestiÃ³n de Medicamentos

* **Altas**: formulario o escaneo (OCR o cÃ³digo de barras).
* **Bajas**: eliminar medicamento (local y remoto).
* **Cambios**: editar cantidad restante, dosis o caducidad.
* **SincronizaciÃ³n bidireccional**: cada cambio local se sube a Firestore.

---

### ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ GestiÃ³n Familiar (Web y App)

* Permitir que un usuario registre familiares (`linked_family`).
* Un familiar puede consultar:

  * Medicamentos activos
  * Dosis
  * Fechas de caducidad
  * Registro de tratamientos
* Todo basado en consentimiento del usuario principal.

---

### ğŸ©¸ Registro de Tratamientos Especiales

* Permitir aÃ±adir mediciones como:

  * Glucosa (mg/dL)
  * PresiÃ³n (mmHg)
  * Peso (kg)
* Mostrar grÃ¡ficas simples de historial (por dÃ­a o semana).
* Guardar en la colecciÃ³n `treatments`.

---

### ğŸ“¸ OCR y CÃ³digo de Barras (solo Android/iOS)

* **OCR con Google ML Kit:**

  * Extraer texto desde foto de medicamento o receta.
  * Identificar nombre, marca y caducidad mediante expresiones regulares.
* **Mobile Scanner:**

  * Escanear cÃ³digo de barras del empaque para buscar coincidencias en Firestore.

---

### ğŸ”” Notificaciones PUSH

* Recordatorios automÃ¡ticos de toma de medicina.
* Generar notificaciones locales (si no hay conexiÃ³n).
* Enviar notificaciones push (FCM) segÃºn horario registrado.

---

## ğŸ”¹ Comportamiento de SincronizaciÃ³n

1. Al iniciar sesiÃ³n:

   * Descargar `medicines`, `treatments`, `notifications` y `linked_family`.
   * Guardar en base de datos local (`sqflite`).
2. Cuando el usuario agrega, elimina o edita:

   * Actualiza Firestore.
   * Refresca almacenamiento local.
3. Si estÃ¡ sin conexiÃ³n:

   * Guarda cambios localmente.
   * Al reconectarse, sincroniza automÃ¡ticamente.

---

## ğŸ”¹ Datos de Prueba Iniciales (para pruebas locales)

### ğŸ”¸ Ejemplo en colecciÃ³n `medicines`

```json
{
  "user_id": "uid_test_123",
  "name": "Paracetamol 500mg",
  "type": "tabletas",
  "total_quantity": 24,
  "remaining_quantity": 12,
  "dosage": "1 tableta cada 8 horas",
  "expiration_date": "2026-03-01T00:00:00.000Z",
  "photo_url": "https://firebasestorage.googleapis.com/.../paracetamol.jpg",
  "barcode": "7501008439255",
  "created_at": "2025-11-04T10:00:00.000Z"
}
```

### ğŸ”¸ Ejemplo en colecciÃ³n `treatments`

```json
{
  "user_id": "uid_test_123",
  "type": "diabetes",
  "measurement_value": 108,
  "measurement_unit": "mg/dL",
  "timestamp": "2025-11-04T08:30:00.000Z"
}
```

---

## ğŸ”¹ Lineamientos para CursorAI

* MantÃ©n **coherencia de cÃ³digo** y estructura conforme al proyecto actual.
* Toda lectura o escritura debe usar **Firestore y Provider** para manejo de estado.
* Asegura **compatibilidad con Flutter Web**, evitando dependencias no soportadas.
* La UI debe ser **accesible y legible para adultos mayores** (botones grandes, texto claro, buen contraste).
* Toda pantalla debe incluir **narraciÃ³n opcional con FlutterTTS**.
* Evita duplicaciÃ³n de medicamentos: verifica coincidencias por `barcode` o `name`.
* Todas las operaciones deben manejar **try-catch** con mensajes amigables.

